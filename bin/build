#!/bin/bash
#
# $Info: Invoke cmake/make in build directory if present and generate logfile. $
# $Syntax: build TARGET $

TARGET="platform" # default
CMAKE_OPTS=""
MAKE_OPTS=""

printf "|\n|\n|\n"
clear;
ruler '*'

while [[ "$1" =~ -.* ]]; do
  if [[ "$1" == "-v" ]]; then
    MAKE_OPTS="${MAKE_OPTS} VERBOSE=1"
  shift
  elif [[ "$1" == "-d" ]]; then
    CMAKE_OPTS="${CMAKE_OPTS} -DCMAKE_BUILD_TYPE=Debug"
    shift
  else
    break
  fi
done
if [[ $# > 0 ]]; then
  TARGET="$1"
  shift
else
  echo "INFO: Using default target - $TARGET"
fi
BDIR="."
if [[ -r build ]]; then
  BDIR=".."
  echo "cd build"
  cd build
fi

rm -f make.log run.log $BDIR/make.log $BDIR/run.log
if [[ -r CMakeLists.txt ]]; then
  echo "cmake ${CMAKE_OPTS}$BDIR 2>&1 | tee -a make.log"
  cmake "${CMAKE_OPTS}" $BDIR
fi
echo "make $TARGET ${MAKE_OPTS} 2>&1 | tee -a $BDIR/make.log"
make $TARGET ${MAKE_OPTS} 2>&1 | tee -a $BDIR/make.log
# The end
